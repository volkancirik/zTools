{% extends "base.html" %}
{% load i18n %}
{% load helper %}
{% load enum_helper %}
{% block extra_head %}
    <script type="text/javascript" src="{{ STATIC_URL }}js/popup-plugin.js"></script>
{% endblock %}

{% block content %}
    <br/>
     <div style="border-bottom: 1px solid #333333;font-size: 14px;color:#000000;">
        Returned Orderitem Tracking System <b>For Order Management</b>
     </div>
     <form id="searchReturnedItemsForm" action="/rts/home_order_management/" method="post">
        {% csrf_token %}
            <table class="actionPanel searchPanel" cellpadding="0" cellspacing="0" width="100%">

                        <tr>
                            <td style="background-color: none;">
                                Return Status
                                <select name='statusFilter' id='id_statusFilter'>
                                    <option value='all'>{% trans "all" %}</option>
                                    {% enum2option statusList %}
                                </select>

                                <a class="submitButton" onclick="return rts_search();">
                                    <span> {% trans "Search" %} </span>
                                </a>
                            </td>
                        </tr>
                </table>
                <script type="text/javascript">
                    function rts_search(){
                        $('#id_buttonSource').val("search");
                        $('#searchReturnedItemsForm').submit();
                    }
                </script>
     </form>
<div class="tabbed">
	<div class="tab-content" style="display:block;">
		<div class="items">
    <table id="orderList">
                <thead>
                    <tr>
                        {# translation needed #}
                        <th>{% trans "Select Item" %}</th>
                        <th>{% trans "return_status" %}</th>
                        <th> Order Number </th>
                        <th> SKU </th>
                        <th> ID Sales Order Item</th>
                        <th> Customer Billing Name </th>
                        <th> Customer Phone </th>
                        <th> Customer e-mail </th>
                        <th> Paid Price </th>
                        <th> BOB Status </th>
                        <th> Coupon Code  </th>
                        <th> Coupon Money Value</th>
                        <th> Coupon Percent </th>
                        <th> Bank Name </th>
                        <th> Customer Contacted</th>
                        <th> Refund Reference Number</th>
                        <th> New Coupon Need</th>
                        <th> New Coupon Code</th>
                        <th> Return Date</th>
                        <th> Refund Date</th>
                        {# translation needed #}
                    </tr>
                </thead>
                <tbody >
                    {% for r in oibfr_list %}

                        <tr style="height:30px;">
                            <td>
                                <span class="actionLabel" onclick="viewRefundBox('{{ r.order_nr  }}',
                                        '{{ r.id_sales_order_item }}',
                                        '{{ r.sku }}',
                                        '{{ r.pk }}',
                                        '{{ r.returneditemdetails.refund_reference_number|None2Empty }}',
                                        '{{ r.returneditemdetails.customer_contacted|None2Empty }}',
                                        '{{ r.returneditemdetails.isCouponNeeded|None2Empty }}',
                                        '{{ r.returneditemdetails.new_coupon|None2Empty }}',
                                        '{{ r.payment_method }}')">
                                    Select {# translation needed #}
                                </span>
                            </td>
                            <td>
                                {{ r.returneditemdetails.get_status_display }}
                            </td>
                            <td><a href="https://bob.zidaya.com/orderprocessing/order/index/id/{{ r.id_sales_order }})" target="_blank">{{ r.order_nr }}</a></td>
                            <td><a href="http://static.zidaya.com/p/-{{ r.id_catalog_config|reverse }}-1-zoom.jpg" target="_blank">{{ r.sku }}</a></td>
                            <td>{{ r.id_sales_order_item}}</td>
                            <td>{{ r.billing_name|None2Empty }}</td>
                            <td>{{ r.billing_phone|None2Empty }}</td>
                            <td>{{ r.customer_email|None2Empty }}</td>
                            <td>{{ r.paid_price|None2Empty }}</td>
                            <td>{{ r.bob_status }}</td>
                            <td>{{ r.coupon_code|None2Empty }}</td>
                            <td>{{ r.coupon_money_value|None2Empty }}</td>
                            <td>{{ r.coupon_percent|None2Empty }}</td>
                            <td>{{ r.payment_method|None2Empty }}</td>
                            <td>
                                {% if r.returneditemdetails.status > 0 %}
                                    {{ r.returneditemdetails.customer_contacted|None2Empty }}
                                {% endif %}
                            </td>
                            <td>
                                {% if r.returneditemdetails.status > 0 %}
                                    {{ r.returneditemdetails.refund_reference_number|None2Empty }}
                                {% endif %}
                            </td>
                            <td>
                                {% if r.returneditemdetails.status > 0 %}
                                    {{ r.returneditemdetails.isCouponNeeded|None2Empty }}
                                {% endif %}
                            </td>
                            <td>
                                {% if r.returneditemdetails.status > 0 and r.returneditemdetails.isCouponNeeded %}
                                    {{ r.returneditemdetails.new_coupon|None2Empty }}
                                {% endif %}
                            </td>
                            <td>
                                    {{ r.returneditemdetails.create_date|date:"d/M/Y H:i:s" }}
                            </td>
                            <td>
                                {% if r.returneditemdetails.status > 0 %}
                                    {{ r.returneditemdetails.update_date|date:"d/M/Y H:i:s" }}
                                {% endif %}
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
		</div>
	</div>
    {% include "cross_order/boxes/refunded_item_box.html" %}


    <div id="test-div">

    </div>

</div>
<script type="text/javascript">
    $(document).ready(function(){
        var oTable = $('#orderList').dataTable(
                {
                    "sScrollY": "320px",
                    "bJQueryUI": true,
                    "sPaginationType": "full_numbers",
                    "sScrollX": "100%"
                }
        );
{#        $('#id_statusFilter').val({{ cstatus.pk }});#}
        $('.checkboxClass').attr("checked", "");
        $('.allSelect').click(function(){
            if($(this).is(':checked')){
                $('.checkboxClass').attr("checked", 'checked');
            }
            else
                $('.checkboxClass').attr("checked", "");
        });

        $('#id_statusFilter').val({{ status }});
    });
</script>

{% endblock %}